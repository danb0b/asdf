<!doctype html><html lang=en-us><head><meta charset=utf-8><title>ASUS Zenbook Issues | Dan Aukes</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="This is meta description"><meta name=author content="Dan Aukes"><meta name=generator content="Hugo 0.100.0"><link rel=stylesheet href=https://danaukes.com/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://danaukes.com/plugins/slick/slick.css><link rel=stylesheet href=https://danaukes.com/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://danaukes.com/plugins/venobox/venobox.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><link rel=stylesheet href=https://danaukes.com/scss/style.min.css media=screen><link rel="shortcut icon" href=https://danaukes.com/images/favicon.png type=image/x-icon><link rel=icon href=https://danaukes.com/images/favicon.png type=image/x-icon><script>(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','','auto'),ga('send','pageview')</script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}},window.addEventListener('load',e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+='has-jax'})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><div class=preloader></div><header class=navigation><div class=container><nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0"><a class="navbar-brand mobile-view" href=https://danaukes.com><img class=img-fluid src=https://danaukes.com/da-small.png alt="Dan Aukes"></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class=ti-menu></i></button><div class="collapse navbar-collapse text-center" id=navigation><div class=desktop-view><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=https://twitter.com/danaukes><i class=ti-twitter-alt></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/danb0b><i class=ti-github></i></a></li><li class=nav-item><a class=nav-link href=https://www.linkedin.com/in/dan-aukes-502995212/><i class=ti-linkedin></i></a></li></ul></div><a class="navbar-brand mx-auto desktop-view" href=https://danaukes.com><img class=img-fluid src=https://danaukes.com/da-small.png alt="Dan Aukes"></a><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://danaukes.com/bookmarks/>Bookmarks</a></li><li class=nav-item><a class=nav-link href=https://danaukes.com/code/>Code</a></li><li class=nav-item><a class=nav-link href=https://danaukes.com/notebook/>Notebook</a></li><li class=nav-item><a class=nav-link href=https://danaukes.com/recipes/>Recipes</a></li><li class=nav-item><a class=nav-link href=https://danaukes.com/websites/>Websites</a></li></ul><div class="search pl-lg-4"><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://danaukes.com/search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder="Type & Hit Enter..."></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><section class=section-sm><div class=container><div class=row><div class="col-lg-8 mx-auto"><div class=text-center><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/notebook>notebook</a></li><li class="breadcrumb-item active" aria-current=page>asus-issues</li></ol></nav></div><h2>ASUS Zenbook Issues</h2><div class="mb-3 post-meta"><span>By Dan Aukes</span></div><div class="content mb-5"><p>I have an ASUS Zenbook UM425U, currently working great with Ubuntu 21.04 loaded. Upon installing Ubuntu 20.04, initially the keyboard worked but other aspects of the computer did not, such as being able to control screen brightness, fan speed, etc. After the kernel was automatically updated, however, suddently I was unable to use the keyboard, but intermittently. Each reboot might allow me or not. To add an additional wrinkle, I had also encrypted my hard drive using LUKS, meaning that if I was traveling or did not have access to an external keyboard, I would be locked out.</p><h2 id=install-a-compatible-kernel>Install a compatible Kernel.</h2><p>The first thing I did was to manually install a kernel I could at least unlock my computer with. I followed the instructions <a href=https://www.how2shout.com/linux/install-linux-5-8-kernel-on-ubuntu-20-04-lts/>here</a> to get the linux 5.8.18 kernel installed.</p><p>List all kernels:</p><pre tabindex=0><code>dpkg --list | grep linux-image
</code></pre><h2 id=recompile-your-kernel>Recompile your Kernel</h2><p>The real solution, however, is discussed in this <a href="https://www.mail-archive.com/search?l=ubuntu-bugs@lists.ubuntu.com&q=subject:%22%5C%5BBug+1943832%5C%5D+Re%5C%3A+Keyboard+doesn%27t+work+on+a+%5C%22cold+boot%5C%22+with+built%5C-in+%5C%22i8042+PC+Keyboard+controller%5C%22+%5C%28ASUS+UM425UA%5C%29%22&o=newest&f=1">chain of emails</a>, and the solution is discussed <a href=https://www.mail-archive.com/ubuntu-bugs@lists.ubuntu.com/msg5955393.html>here</a>.</p><ol><li><p>open <code>software-properties-gtk</code> and enable source code</p></li><li><p>Follow instructions to <a href=https://wiki.ubuntu.com/Kernel/BuildYourOwnKernel>build your own kernel</a></p><ol><li><p>get dependencies</p></li><li><p>get source ()</p><pre tabindex=0><code>apt-get source linux-image-unsigned-$(uname -r)
</code></pre></li><li><p>update configs</p><pre tabindex=0><code>chmod a+x debian/rules
chmod a+x debian/scripts/*
chmod a+x debian/scripts/misc/*
LANG=C fakeroot debian/rules clean
LANG=C fakeroot debian/rules editconfigs # you need to go through each (Y, Exit, Y, Exit..) or get a complaint about config late
</code></pre></li><li><p>Use the advice from <a href=https://www.mail-archive.com/ubuntu-bugs@lists.ubuntu.com/msg5955393.html>here</a>, update yoru configuration (don&rsquo;t uncheck &ldquo;support for uevent&rdquo;)</p><pre tabindex=0><code>ASUS UM425UA internal keyboard doesn&#39;t work on a &#34;cold boot&#34; (first 
power-on). It activates only after restart.
  I noticed it when tried to boot live image of Ubuntu 20.04.3
  This problem probably appeared with kernel version 5.9 or 5.10 because with 
Ubuntu 20.04.2 live image (Linux 5.8) keyboard loads fine. Tried kernel 5.14 
and it&#39;s still affected.
  I tried to recompile kernels 5.11 &amp; 5.13 with SERIO_I8042 set as a module (as 
suggested in an Arch Linux bug report) and keyboard now works from the first 
start.

  In &#34;make config&#34; the changes are:
  Device Drivers -&gt;
    &gt; Generic Driver Options -&gt; [ ] Support for uevent #may slowdown boot, 
needed only for U14.04
    &gt; Input device support
       &gt; Keyboards -&gt; [M] AT keyboard
       &gt; Hardware I/O ports -&gt; [M] i8042 PC Keyboard controller

  It changed such lines in config:
  CONFIG_KEYBOARD_ATKBD=m
  CONFIG_SERIO_I8042=m
  CONFIG_SERIO_LIBPS2=m

  References:
  https://bugs.archlinux.org/task/70384
  https://ubuntuforums.org/showthread.php?t=2459149

https://linux.org/threads/asus-zenbook-14-um425ua-keyboard-not-respond-during-cold-boot.33738/#post-133830

  P.S. Other option which helped me was a GRUB parameter &#34;i8042.reset=1&#34; but it 
had a positive effect only with kernel 5.11
</code></pre></li><li><p>These changes break the rules. Modify</p><pre tabindex=0><code>nano debian.master/config/annotations
</code></pre><ol><li>search for &ldquo;CONFIG_KEYBOARD_ATKBD&rdquo;, &ldquo;CONFIG_SERIO_I8042&rdquo;, and &ldquo;CONFIG_SERIO_LIBPS2&rdquo; and set amd64 option to &ldquo;m&rdquo; for each.</li></ol></li><li><p>Update version number so that the apt repository doesn&rsquo;t supersede it on the next upgrade (according to <a href=https://wiki.ubuntu.com/Kernel/BuildYourOwnKernel#Modifying_the_configuration>the ubuntu guide</a>)</p><ul><li>add a local version modifier like &ldquo;+test1&rdquo; to the end of the first version number in the debian.master/changelog file before building.</li><li>This will help identify your kernel when running as it also appears in uname -a.</li><li>Note that when a new Ubuntu kernel is released that will be newer than your kernel (which needs regenerating), so care is needed when upgrading.</li><li><strong>NOTE:</strong> do not attempt to use CONFIG_LOCALVERSION as this <em>will</em> break the build.</li></ul><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano debian.master/changelog
</span></span></code></pre></div></li><li><p>build</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#111>LANG</span><span style=color:#f92672>=</span>C fakeroot debian/rules clean
</span></span><span style=display:flex><span><span style=color:#75715e># quicker build:</span>
</span></span><span style=display:flex><span><span style=color:#111>LANG</span><span style=color:#f92672>=</span>C fakeroot debian/rules binary-headers binary-generic binary-perarch
</span></span><span style=display:flex><span><span style=color:#75715e># if you need linux-tools or lowlatency kernel, run instead:</span>
</span></span><span style=display:flex><span><span style=color:#111>LANG</span><span style=color:#f92672>=</span>C fakeroot debian/rules binary
</span></span></code></pre></div></li><li><p>Install the three-package set (on your build system, or on a different target system) with dpkg -i and then reboot:</p><pre tabindex=0><code>
sudo dpkg -i linux*5.11.0*.deb
sudo apt install -f #to install any missing packages
sudo apt autoremove # to remove any unused packages
sudo reboot
</code></pre></li><li><p>Reinstall virtualbox-dkms</p><pre tabindex=0><code>sudo apt install --reinstall virtualbox-dkms 
sudo modprobe vboxdrv
</code></pre></li></ol></li></ol><hr><h1 id=things-that-didnt-work>Things that didn&rsquo;t work</h1><h2 id=modify-initramfs>Modify initramfs</h2><p>find HID modules</p><pre tabindex=0><code>lsmod
</code></pre><p>add those modules to initramfs</p><pre tabindex=0><code>sudo nano /etc/initramfs-tools/modules
</code></pre><p>add one per line</p><pre tabindex=0><code>#amdgpu 
asus_wmi 
asus_nb_wmi
atkbd 
dm_crypt 
ext4 
fat 
i2c_hid 
i8042
ohci_pci
xhci_pci
xhci_pci_renesas
edac_mce_amd
kvm_amd
kvm
serio_raw
usbcore
uhci_hcd
ehci_hcd
usbhid
</code></pre><p>update initramfs:</p><pre tabindex=0><code>sudo update-initramfs -u -k all
</code></pre><h2 id=blacklist-amdgpu>Blacklist <code>amdgpu</code></h2><p>when doing update-initramfs in kernel 5.11.0-31, there are some messages about amdgpu missing drivers</p><p>Add the following line to /etc/modprobe.d/blacklist.conf.</p><pre tabindex=0><code>blacklist amdgpu
</code></pre><p>As initramfs contains modprobe configuration, update the initramfs and reboot:</p><pre tabindex=0><code>sudo update-initramfs -u -k all
</code></pre><p>Check whether the driver blacklisted or not, the following command should output nothing.</p><pre tabindex=0><code>$ lsmod | grep amdgpu
</code></pre><p>But this kills hdmi&mldr;</p></div></div></div></div></section><footer class=text-capitalize><div class=container><div class="row justify-content-center"><div class="col-12 border-top py-4 text-center"></div><div class="col-lg-4 col-sm-6 mb-5 text-center"><h6 class=mb-4>Contact Me</h6><ul class=list-unstyled><li class=mb-3><i class="ti-location-pin mr-3 text-primary"></i>Arizona, USA</li></li></ul></div><div class="col-lg-4 col-sm-6 mb-5 text-center"><h6 class=mb-4>External</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://twitter.com/danaukes>twitter</a></li><li class=mb-3><a class=text-dark href=https://github.com/danb0b>personal github</a></li><li class=mb-3><a class=text-dark href=https://www.linkedin.com/in/dan-aukes-502995212/>linkedin</a></li></ul></div><div class="col-lg-4 col-sm-6 mb-5 text-center"><h6 class=mb-4>Quick Links</h6><ul class=list-unstyled><li class=mb-3><a class=text-dark href=https://asu-2221-egr314-14618.slack.com>EGR314 Slack</a></li><li class=mb-3><a class=text-dark href=https://idealab-asu.slack.com>IDEAlab Slack</a></li><li class=mb-3><a class=text-dark href=https://danaukes.com/about/>About</a></li><li class=mb-3><a class=text-dark href=https://danaukes.com/calendar/>Calendar</a></li><li class=mb-3><a class=text-dark href=https://danaukes.com/contact/>Contact</a></li></ul></div><div class="col-12 mb-5 text-center"><a href=https://danaukes.com><img src=https://danaukes.com/da-small.png alt="Dan Aukes"></a></div><div class="col-12 mb-5 text-center"><p>| copyright © 2021 Daniel Aukes. All Rights Reserved. |</p><p><a href=https://github.com/danb0b/danb0b.github.io/edit/master/content/notebook/asus-issues.md>Edit this Page</a></p></div></div></div></footer><script>var indexURL="https://danaukes.com/index.json"</script><script src=https://danaukes.com/plugins/jQuery/jquery.min.js></script>
<script src=https://danaukes.com/plugins/bootstrap/bootstrap.min.js></script>
<script src=https://danaukes.com/plugins/slick/slick.min.js></script>
<script src=https://danaukes.com/plugins/venobox/venobox.min.js></script>
<script src=https://danaukes.com/plugins/search/fuse.min.js></script>
<script src=https://danaukes.com/plugins/search/mark.js></script>
<script src=https://danaukes.com/plugins/search/search.js></script>
<script src=https://danaukes.com/js/script.min.js></script></body></html>